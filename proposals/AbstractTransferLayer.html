<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">@import url('https://themes.googleusercontent.com/fonts/css?kit=na2xy4REgy2vjVAZtpZNc_yDN7cgeRfA_woaXUgMUYU');ol{margin:0;padding:0}table td,table th{padding:0}.c9{border-right-style:solid;padding:7pt 7pt 7pt 7pt;border-bottom-color:#000000;border-top-width:2pt;border-right-width:2pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:2pt;border-top-style:solid;background-color:#fce5cd;border-left-style:solid;border-bottom-width:2pt;width:82.5pt;border-top-color:#000000;border-bottom-style:solid}.c8{border-right-style:solid;padding:7pt 7pt 7pt 7pt;border-bottom-color:#000000;border-top-width:2pt;border-right-width:2pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:2pt;border-top-style:solid;border-left-style:solid;border-bottom-width:2pt;width:126pt;border-top-color:#000000;border-bottom-style:solid}.c13{border-right-style:solid;padding:7pt 7pt 7pt 7pt;border-bottom-color:#000000;border-top-width:2pt;border-right-width:2pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:2pt;border-top-style:solid;border-left-style:solid;border-bottom-width:2pt;width:99pt;border-top-color:#000000;border-bottom-style:solid}.c4{border-right-style:solid;padding:7pt 7pt 7pt 7pt;border-bottom-color:#000000;border-top-width:2pt;border-right-width:2pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:2pt;border-top-style:solid;border-left-style:solid;border-bottom-width:2pt;width:115.5pt;border-top-color:#000000;border-bottom-style:solid}.c23{border-right-style:solid;padding:7pt 7pt 7pt 7pt;border-bottom-color:#000000;border-top-width:2pt;border-right-width:2pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:2pt;border-top-style:solid;border-left-style:solid;border-bottom-width:2pt;width:82.5pt;border-top-color:#000000;border-bottom-style:solid}.c11{color:#000000;font-weight:bold;text-decoration:none;vertical-align:baseline;font-size:12pt;font-family:"Calibri";font-style:normal}.c6{color:#000000;font-weight:normal;text-decoration:none;vertical-align:baseline;font-size:12pt;font-family:"Calibri";font-style:normal}.c10{color:#ffffff;font-weight:bold;text-decoration:none;vertical-align:baseline;font-size:12pt;font-family:"Calibri";font-style:normal}.c1{padding-top:0pt;padding-bottom:0pt;line-height:1.15;text-align:center}.c2{border-spacing:0;border-collapse:collapse;margin-right:auto}.c22{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c0{orphans:2;widows:2}.c7{font-size:10pt;font-family:"Consolas"}.c12{padding-top:10pt;padding-bottom:10pt}.c20{height:32pt}.c21{height:30pt}.c16{font-weight:bold}.c14{height:13pt}.c3{page-break-after:avoid}.c15{height:25pt}.c5{height:11pt}.c24{height:29pt}.c19{height:22pt}.c17{background-color:#4a86e8}.c18{height:17pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c22"><h1 class="c0 c3" id="h.ilu5vvlj0304"><span>WoT-AP Proposal for Interaction Model mapping to an Abstract Transfer Layer</span></h1><h2 class="c0 c3" id="h.uhmzb4ky9okw"><span>Scope</span></h2><p class="c0"><span>The scope of this proposal is to define an abstract transfer layer interface and default mapping of the event, action, and property endpoints identified by the &quot;hrefs&quot; elements in a Thing Description resource, as defined in the W3C Web of Things IG Current Practice document.</span></p><p class="c0 c5"><span></span></p><p class="c0"><span>This document is intended to provide guidance for the creation of interoperable network interfaces between WoT Servient instances and other WoT clients and servers, using standard transfer layer protocols HTTP, CoAP, and MQTT.</span></p><h2 class="c0 c3" id="h.96cocoxu0rjq"><span>Abstract transfer layer</span></h2><p class="c0"><span>The examples use an abstract transfer layer, with the following mapping to REST transfer layer operations and pubsub communication patterns</span></p><p class="c0 c5"><span></span></p><p><span></span></p><a id="t.3cf4536468cd23627f787239377d9d6a3914b80e"></a><a id="t.0"></a><table class="c2"><tbody><tr class="c21"><td class="c17 c23" colspan="1" rowspan="1"><p class="c1"><span class="c10">Abstract Transfer</span></p></td><td class="c13 c17" colspan="1" rowspan="1"><p class="c1"><span class="c10">Pubsub</span></p></td><td class="c4 c17" colspan="1" rowspan="1"><p class="c1"><span class="c10">CoAP</span></p></td><td class="c8 c17" colspan="1" rowspan="1"><p class="c1"><span class="c10">HTTP</span></p></td></tr><tr class="c19"><td class="c9" colspan="1" rowspan="1"><p class="c1"><span class="c11">Create</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c1"><span class="c6">(Publish)</span></p></td><td class="c4" colspan="1" rowspan="1"><p class="c1"><span class="c6">POST</span></p></td><td class="c8" colspan="1" rowspan="1"><p class="c1"><span class="c6">POST</span></p></td></tr><tr class="c20"><td class="c9" colspan="1" rowspan="1"><p class="c1"><span class="c11">Retrieve</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c1"><span class="c6">Subscribe</span></p><p class="c1"><span class="c6">(with retain)</span></p></td><td class="c4" colspan="1" rowspan="1"><p class="c1"><span class="c6">GET</span></p></td><td class="c8" colspan="1" rowspan="1"><p class="c1"><span class="c6">GET</span></p></td></tr><tr class="c18"><td class="c9" colspan="1" rowspan="1"><p class="c1"><span class="c11">Update</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c1"><span class="c6">Publish</span></p></td><td class="c4" colspan="1" rowspan="1"><p class="c1"><span class="c6">PUT</span></p></td><td class="c8" colspan="1" rowspan="1"><p class="c1"><span class="c6">PUT</span></p></td></tr><tr class="c14"><td class="c9" colspan="1" rowspan="1"><p class="c1"><span class="c11">Delete</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c1"><span class="c6">N/A</span></p></td><td class="c4" colspan="1" rowspan="1"><p class="c1"><span class="c6">DELETE</span></p></td><td class="c8" colspan="1" rowspan="1"><p class="c1"><span class="c6">DELETE</span></p></td></tr><tr class="c24"><td class="c9" colspan="1" rowspan="1"><p class="c1"><span class="c11">Observe</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c1"><span class="c6">Subscribe</span></p></td><td class="c4" colspan="1" rowspan="1"><p class="c1"><span class="c6">GET with OBS option</span></p></td><td class="c8" colspan="1" rowspan="1"><p class="c1"><span class="c6">GET text/stream, TE=chunked (SSE)</span></p></td></tr><tr class="c15"><td class="c9" colspan="1" rowspan="1"><p class="c1"><span class="c11">Notify</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c1"><span class="c6">Notify Client (onMessage)</span></p></td><td class="c4" colspan="1" rowspan="1"><p class="c1"><span class="c6">Response with OBS option</span></p></td><td class="c8" colspan="1" rowspan="1"><p class="c1"><span class="c6">SSE chunk Response</span></p></td></tr></tbody></table><p class="c0 c12 c5"><span></span></p><h2 class="c0 c3" id="h.abaaf4kgbmqg"><span>TD example</span></h2><p class="c0"><span>Events, actions, and properties defined in a Thing Description contain one or more &quot;hrefs&quot; resource references which identify transfer layer endpoints using URIs or other transfer layer specific identifiers. For the purpose of this proposal, URIs are assumed.</span></p><p class="c0 c12"><span class="c7">{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br> &nbsp;&quot;properties&quot;: [<br> &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp;&quot;@type&quot;: &quot;sensor:Temperature&quot;,<br> &nbsp; &nbsp; &nbsp;&quot;name&quot;: &quot;temperature&quot;,<br> &nbsp; &nbsp; &nbsp;&quot;sensor:unit&quot;: &quot;sensor:Celsius&quot;,<br> &nbsp; &nbsp; &nbsp;&quot;valueType&quot;: &quot;xsd:float&quot;,<br> &nbsp; &nbsp; &nbsp;&quot;writable&quot;: false,<br> &nbsp; &nbsp; &nbsp;</span><span class="c7 c16">&quot;hrefs&quot;: &quot;temp&quot;</span><span class="c7"><br> &nbsp; &nbsp;}<br> &nbsp;]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br>}</span></p><p class="c0 c12"><span>The hrefs key value pair contains a URI pointing to the resource that exposes the described property, in this example the URI is &quot;temp&quot;, which according to RFC3986 should be resolved as a relative URI from the current URI context (the URI of the thing)</span></p><p class="c0 c12"><span>Events and Actions also contain &quot;hrefs&quot; definitions for exposed transfer layer endpoints which are used in a similar fashion.</span></p><h2 class="c0 c12 c3" id="h.i13d1b890sob"><span>WoT Interaction Model mapping to the abstract transfer layer</span></h2><p class="c0"><span>These sections define the mapping of Event, Action, and Property elements of the W3C WoT Interaction Model to operations exposed by the abstract transfer layer. Additional resource classes ActionInstance and Subscription are defined to expose explicit representations of long running state transition relationships.</span></p><h2 class="c0 c12 c3" id="h.c9j2b0u6uo68"><span>Property</span></h2><p class="c0"><span>The Property resource exposes a value of a property, and has the following methods:</span></p><h4 class="c0 c3" id="h.6dr8dbgwmzv0"><span>Retrieve (getProperty)</span></h4><p class="c0"><span>Retrive implements the getProperty operation, which returns a current representation of the property according to the type definition for the resource.</span></p><h4 class="c0 c3" id="h.xtsqu9oserfr"><span>Update (setProperty)</span></h4><p class="c0"><span>Update implements the setProperty operation, which accepts a representation of the desired state of the resource, according to the type definition, and replaces the resource representation with the supplied representation</span></p><h4 class="c0 c3" id="h.gxg0quknm2ti"><span>Observe</span></h4><p class="c0"><span>Observe invokes the transfer layer asynchronous notification mechanism, and registers a retrieve request with the resource server such that a new response will be sent each time the resource is updated. This can use the familiar &quot;RESThook&quot; pattern for REST resources ans is analogous to MQTT SUBSCRIBE.</span></p><h4 class="c0 c3" id="h.vwzxjch0u815"><span>Create (createSubscription)</span></h4><p class="c0"><span>See &quot;Subscription&quot; section.</span></p><h2 class="c0 c3 c12" id="h.u9nbzjli3fu9"><span>Event</span></h2><p class="c0"><span>The Event resource emits instances of events. The Event resource allows the following methods:</span></p><h4 class="c0 c3" id="h.7y38pc7t5mjz"><span>Retrieve (getEvents)</span></h4><p class="c0"><span>The Event resource may keep a list of recent events, which may be retrieved using the retrieve method on the Event resource. This resource should at least supply a representation of the most recently emitted event.</span></p><h4 class="c0 c3" id="h.pthyml2o3c42"><span>Observe </span></h4><p class="c0"><span>Observe of an event resource registers a retrieve request with the resource server, as it does with property resources. Each time an event is emitted by the event source, a representation of the event will be sent as a notification response to the Observe operation.</span></p><h4 class="c0 c3" id="h.d17oepw8i50j"><span>Create (createSubscription)</span></h4><p class="c0"><span>See &quot;Subscription&quot; section.</span></p><h2 class="c0 c3" id="h.ah8aogn0vqt"><span>Action</span></h2><p class="c0"><span>The Action resource accepts commands to invoke Actions with a set of defined parameters. The Action resource allows the following methods:</span></p><h4 class="c0 c3" id="h.96ad0douh6r9"><span>Create (invokeAction)</span></h4><p class="c0"><span>Performing a Create method on an action resource invokes the action and creates an ActionInstance resource which represents the pending, executing, or final state of the action. The return information from this method includes an identifier, location or handle, for the created ActionInstance.</span></p><h4 class="c0 c3" id="h.nczyicm9hblq"><span>Retrieve (getActionInstances)</span></h4><p class="c0"><span>Performing a Retrieve method operation on an Action resource will return a list (array) of zero or more pending, executing, or finished ActionInstance representations. </span></p><h2 class="c0 c3" id="h.rkpnx3co3owt"><span>ActionInstance</span></h2><p class="c0"><span>ActionInstances are created when actions are invoked, and allow tracking and managing the progress of running actions. When an Action is invoked, a handle to an ActionInstance is returned. The ActionInstance allows the following methods:</span></p><h4 class="c0 c3" id="h.rzs8q7ys11x1"><span>Observe</span></h4><p class="c0"><span>Register a retrieve request with the resource server which transmits each update on the ActionInstance as a progress update, consisting of at least one update to indicate the final disposition of the physical action, success or failure.</span></p><h4 class="c0 c3" id="h.joz5y9ki7p70"><span>Update</span></h4><p class="c0"><span>The paramaters of a pending or executing ActionInstance may be modified, potentially affecting the physical actuation pending or in progress. Updates of an ActionInstance will result in notification responses transmitted to any registered Observers.</span></p><h4 class="c0 c3" id="h.bl35egaqbk3t"><span>Delete</span></h4><p class="c0"><span>Am ActionInstance may be deleted, potentially resulting in the cancellation of a pending action or aborting of an action in progress.</span></p><h4 class="c0 c3" id="h.ngoonqfxk4jf"><span>Create (createSubscription)</span></h4><p class="c0"><span>See &quot;Subscription&quot; section.</span></p><h2 class="c0 c3" id="h.2z7jfybltt3f"><span>Subscription</span></h2><p class="c0"><span>Subscriptions are created on Properties, Events, and ActionInstances to link the state changes of the associated property, the updates to the action instance, or emitted events to a transfer layer operation that can update the state of another resource or collection, or publish state updates to a broker. Subscription resources allow the following methods:</span></p><h4 class="c0 c3" id="h.7jgwsoqk95ue"><span>Create (createSubscription)</span></h4><p class="c0"><span>If no target URI is specified, the system will create the target of the subscription at the location returned in the handle for the created subscription. In this case, the resource identified by the handle may be observed or have another subscription created on it.</span></p><p class="c0 c5"><span></span></p><p class="c0"><span>If a target URI is specified, the subscription will use information supplied in the constructor of the subscription to send update or create messages to the target resource.</span></p><p class="c0 c5"><span></span></p><p class="c0"><span>Subscriptions may be used to publish updates to a message broker, for example using the MQTT protocol. For example, if the target resource of the subscription specifies the &quot;mqtt&quot; scheme, the subscription will publish updates to the MQTT broker and topic specified in the target URL.</span></p><h4 class="c0 c3" id="h.vn708i9oogp7"><span>Observe</span></h4><p class="c0"><span>The target resource of a Subscription should be observable.</span></p><p class="c0 c5"><span></span></p><p class="c0"><span>A Subscription created without providing a target URL will result in the creation of an observable resource at the location returned as the handle for the created object.</span></p><h4 class="c0 c3" id="h.ei5akfh741gb"><span>Update</span></h4><p class="c0"><span>A subscription resource, once created, may be updated to change it&#39;s parameter values. Some values of a subscription may be immutable once the subscription is created, for example the target URL.</span></p><h4 class="c0 c3" id="h.unxuz2r7ypny"><span>Delete</span></h4><p class="c0"><span>A subscription resource may be deleted, resulting in the cessation of transmission of any messages. A final message indicating termination of the subscription may be sent, for example CoAP response with obs=1, HTTP 400 response, MQTT LWT message.</span></p><h2 class="c0 c3" id="h.pi8fis4vz7kg"><span>Payload formats</span></h2><p class="c0"><span>TBD - formats and keywords for ActionInstances and Subscriptions</span></p><p class="c0 c5"><span></span></p><p class="c0 c5"><span></span></p><p class="c0 c5"><span></span></p><p class="c0 c12 c5"><span class="c7"></span></p><p class="c0 c12 c5"><span class="c7"></span></p><p class="c0 c12 c5"><span class="c7"></span></p><p class="c0 c12 c5"><span class="c7"></span></p><p class="c0 c12 c5"><span class="c7"></span></p><p class="c0 c12 c5"><span class="c7"></span></p><p class="c0 c12 c5"><span class="c7"></span></p><p class="c0 c12 c5"><span class="c7"></span></p><p class="c0 c12 c5"><span class="c7"></span></p><p class="c0 c12 c5"><span class="c7"></span></p><p class="c0 c12 c5"><span class="c7"></span></p></body></html>